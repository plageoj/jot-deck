# Jot Deck キーバインド仕様

## 1. 設計方針

### 1.1 基本原則
* **Vim + Twitter ハイブリッド:** `h/j/k/l` による Vim ライクなナビゲーションと、`g` プレフィックスによる Twitter ライクなジャンプを組み合わせる。
* **フォーカスベース:** フォーカス対象（Column / Card）によって同じキーが異なる動作を行う。
* **修飾キー最小化:** 頻繁な操作は修飾キーなしで実行可能。
* **カスタマイズ可能:** ユーザーが全キーバインドを変更可能。

### 1.2 フォーカスモデル

アプリケーションは以下のフォーカス状態を持つ：

| フォーカス | 説明 | 遷移方法 |
|:---|:---|:---|
| **Column** | カラムヘッダーにフォーカス。カラム単位の操作が可能。 | Card フォーカス時に `Escape`、または空のカラムを選択 |
| **Card** | カード本体にフォーカス。カード単位の操作が可能。 | Column フォーカス時に `j` / `k` / `Enter` |
| **Edit** | カード内テキスト編集中。CodeMirror がアクティブ。 | Card フォーカス時に `i` / `a` / `Enter` |
| **Command** | コマンドパレット表示中。 | `Ctrl+Shift+p` / `F1` |

```
┌─────────────────────────────────────────────────────────┐
│                      Column Focus                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │ [Column A]  │  │ [Column B]  │  │ [Column C]  │ ←── H/L で移動、並び替え
│  ├─────────────┤  ├─────────────┤  ├─────────────┤      │
│  │   Card 1    │  │   Card 1    │  │   Card 1    │      │
│  │   Card 2    │  │   Card 2    │  │   Card 2    │      │
│  │   Card 3    │  │   Card 3    │  │             │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────┘
        │ j/Enter (最初のカード)    k (最後のカード)
        ▼                           ▼
┌─────────────────────────────────────────────────────────┐
│                       Card Focus                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │  Column A   │  │  Column B   │  │  Column C   │      │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤      │
│  │  [Card 1]   │←─┼─────────────┼──┼─────────────┼─── H/L で別カラムへ移動
│  │   Card 2    │  │   Card 1    │  │   Card 1    │      │
│  │   Card 3    │  │   Card 2    │  │             │  j/k で上下移動
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────┘
        │ i/a/Enter                 ▲
        ▼                           │ Escape
┌─────────────────────────────────────────────────────────┐
│                       Edit Focus                         │
│  ┌─────────────────────────────────────────────────┐    │
│  │  CodeMirror (Vim mode)                          │    │
│  │  ┌───────────────────────────────────────────┐  │    │
│  │  │ カードのテキスト内容を編集中...            │  │    │
│  │  │ █                                         │  │    │
│  │  └───────────────────────────────────────────┘  │    │
│  └─────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

---

## 2. Column フォーカス

カラムヘッダーにフォーカスがある状態。カラム単位の操作を行う。

### 2.1 ナビゲーション

| キー | 動作 |
|:---|:---|
| `h` | 左のカラムへフォーカス移動 |
| `l` | 右のカラムへフォーカス移動 |
| `j` | Card フォーカスへ遷移（カラム内の最初のカードを選択） |
| `k` | Card フォーカスへ遷移（カラム内の最後のカードを選択） |
| `Enter` | Card フォーカスへ遷移（カラム内の最初のカードを選択） |
| `g 1` 〜 `g 9` | n 番目のカラムへ移動（Twitter 風） |

### 2.2 カラム操作

| キー | 動作 |
|:---|:---|
| `H` | カラムを左へ移動（並び替え） |
| `L` | カラムを右へ移動（並び替え） |
| `o` | 現在のカラムに新規カード作成 → Edit フォーカス |
| `n` | 現在のカラムに新規カード作成 → Edit フォーカス（`o` のエイリアス、Twitter 風） |
| `c` | 新規カラム作成（現在のカラムの右） |
| `N` | 新規カラム作成（`c` のエイリアス） |
| `Ctrl+w` | カラムを削除（`u` で Undo 可能） |
| `d d` | カラムを削除（`Ctrl+w` と同等） |
| `Delete` | カラムを削除 |
| `r` | カラム名を編集 |

---

## 3. Card フォーカス

カード本体にフォーカスがある状態。カード単位の操作を行う。

### 3.1 ナビゲーション

| キー | 動作 |
|:---|:---|
| `j` | 下のカードへ移動 |
| `k` | 上のカードへ移動 |
| `h` | 左のカラムへ移動（同じ行位置を維持） |
| `l` | 右のカラムへ移動（同じ行位置を維持） |
| `H` | カードを左のカラムへ移動 |
| `L` | カードを右のカラムへ移動 |
| `J` | カードをカラム内で下へ移動（並び替え） |
| `K` | カードをカラム内で上へ移動（並び替え） |
| `g g` | カラム内の最初のカードへ |
| `G` | カラム内の最後のカードへ |
| `g 1` 〜 `g 9` | n 番目のカラムへ移動（Twitter 風） |
| `Ctrl+u` | 半ページ上へスクロール |
| `Ctrl+d` | 半ページ下へスクロール |
| `Escape` | Column フォーカスへ遷移 |

### 3.2 カード操作

| キー | 動作 |
|:---|:---|
| `i` | Edit フォーカスへ（カーソル位置維持） |
| `a` | Edit フォーカスへ（カーソルを末尾に移動） |
| `o` | 現在のカードの下に新規カード作成 → Edit フォーカス |
| `n` | 現在のカードの下に新規カード作成 → Edit フォーカス（`o` のエイリアス、Twitter 風） |
| `O` | 現在のカードの上に新規カード作成 → Edit フォーカス |
| `N` | 新規カラム作成（現在のカラムの右） |
| `Enter` | 現在のカードを編集（= `i`） |
| `d d` | カードを削除（論理削除） |
| `Delete` | カードを削除（論理削除） |
| `y y` | カードをコピー |
| `p` | カードを下にペースト |
| `P` | カードを上にペースト |
| `f` | カードの score を +1（Twitter 風 favorite） |
| `F` | カードの score を -1 |
| `+` / `=` | カードの score を +1（Vim 風） |
| `-` | カードの score を -1（Vim 風） |

---

## 4. 共通キーバインド（Column / Card フォーカス共通）

### 4.1 Deck 操作

| キー | 動作 |
|:---|:---|
| `g h` | Deck 切り替え（Deck 切り替えパレット表示、Twitter 風） |
| `g d` | Deck 切り替え（`g h` のエイリアス） |
| `Ctrl+p` | Deck 切り替え（Deck 切り替えパレット表示） |
| `Ctrl+n` | 新規 Deck 作成 |

### 4.2 カラム切り替え

| キー | 動作 |
|:---|:---|
| `g n` | カラム切り替え（カラム切り替えパレット表示、Twitter 風） |
| `g c` | カラム切り替え（`g n` のエイリアス） |
| `Ctrl+t` | カラム切り替え（カラム切り替えパレット表示） |

### 4.3 検索

| キー | 動作 |
|:---|:---|
| `/` | 検索モード（Deck 内検索、`/#tag` でタグフィルタ） |

### 4.4 削除スタック（ゴミ箱）

| キー | 動作 |
|:---|:---|
| `u` | 直近の削除から順に復元（削除スタックの先頭をポップ） |
| `g t` | 削除スタック一覧を表示（任意の Column/Card を選択して復元可能） |

### 4.5 その他

| キー | 動作 |
|:---|:---|
| `Ctrl+Shift+p` または `F1` | コマンドパレット表示 |
| `?` または `Ctrl+/` | キーバインドチートシート表示 |
| `Ctrl+,` | 設定画面を開く |
| `Ctrl+z` | Undo |
| `Ctrl+Shift+z`, `Ctrl+y` | Redo |
| `u` | 削除スタックから復元（4.4 参照） |
| `Ctrl+r` | Redo（Vim 風） |

---

## 5. Edit フォーカス

カード内のテキストを編集中の状態。CodeMirror の Vim モードがアクティブ。

**保存動作（Twitter ライク）:**
* フォーカスを外しても編集状態を継続（自動保存しない）
* 明示的に保存コマンドを実行するまで変更は適用されない
* 保存せずに終了すると変更は破棄される

### 5.1 テキスト編集
CodeMirror の Vim モードがそのまま適用される。

| キー | 動作 |
|:---|:---|
| `Escape` | 変更を破棄して Card フォーカスへ戻る |
| `Ctrl+[` | 変更を破棄して Card フォーカスへ戻る（Vim 互換） |
| 通常のVimキー | CodeMirror Vim モードの標準動作 |

### 5.2 保存・終了操作

| キー | 動作 |
|:---|:---|
| `:w` | 保存（編集継続） |
| `:wq` | 保存して Card フォーカスへ |
| `:q` | 変更を破棄して Card フォーカスへ |
| `:q!` | 変更を破棄して Card フォーカスへ（`:q` と同等） |
| `Ctrl+Enter` | カードを保存して Card フォーカスへ |

### 5.3 特殊操作

| キー | 動作 |
|:---|:---|
| `#` + 文字入力 | タグ補完候補を表示 |
| `Tab` | 補完候補を確定 |

---

## 6. Command フォーカス（コマンドパレット）

### 6.1 ナビゲーション

| キー | 動作 |
|:---|:---|
| `Escape` | コマンドパレットを閉じる（元のフォーカスへ戻る） |
| `Enter` | 選択中のコマンドを実行 |
| `j` / `↓` | 次の候補へ |
| `k` / `↑` | 前の候補へ |
| 文字入力 | コマンド絞り込み |

### 6.2 利用可能なコマンド

| コマンド | 説明 |
|:---|:---|
| `Switch Deck` | Deck 一覧を表示して切り替え |
| `New Deck` | 新規 Deck 作成 |
| `New Column` | 新規 Column 作成 |
| `Delete Column` | Column 論理削除 |
| `Trash` | 削除スタック一覧を表示（任意の Column/Card を選択して復元） |
| `Settings` | 設定画面を開く |
| `AI Draft` | AI 清書を開始 |
| `Toggle Theme` | ダーク/ライトモード切り替え |
| `Keyboard Shortcuts` | キーバインド一覧表示 |

---

## 7. カスタマイズ

* ユーザーが全キーバインドを変更可能。
* 設定画面から編集、または設定ファイルを直接編集。

---

## 8. 競合・未解決事項

| 項目 | 問題 | 案 |
|:---|:---|:---|
| マルチカーソル | CodeMirror の Vim モードではサポート限定的 | MVP では対応しない |

---

## 9. キーバインド設計の由来

### 9.1 Vim 由来のキーバインド
* `h/j/k/l` - 方向キー（左/下/上/右）
* `i/a` - Edit フォーカス開始
* `o/O` - 新規カード作成
* `d d` - 削除
* `y y` - ヤンク（コピー）
* `p/P` - ペースト
* `g g` - 先頭へ移動
* `G` - 末尾へ移動
* `u` - Undo
* `Ctrl+r` - Redo
* `H/L` - フォーカスに応じた移動（Column: 並び替え、Card: カラム間移動）
* `J/K` - Card フォーカス時のカード並び替え
* `Escape` - 上位フォーカスへ戻る

### 9.2 Twitter (X) 由来のキーバインド
* `j/k` - 投稿間の移動（Vim と共通）
* `f` - Favorite（スコアアップ）※ 旧 Twitter の favorite キー
* `F` - Unfavorite（スコアダウン）
* `g h` - Deck 切り替え（Twitter の Home へ移動に類似）
* `g n` - カラム切り替え（Twitter の Notifications に類似）
* `g 1` 〜 `g 9` - n 番目のカラムへ（Twitter のリスト移動に類似）
* `/` - 検索（Twitter と共通、`/#tag` でタグフィルタ）
* `?` - ショートカット一覧表示（Twitter と共通）
* `n` - 新規投稿（Jot Deck では `o` のエイリアスとして採用）
