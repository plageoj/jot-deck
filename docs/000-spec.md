# 高速ドラフティングツール 基本設計書 (Draft Specification)

## 1. プロジェクト概要

### 1.1 コンセプト
**「思考の速度で書き、AIで結晶化させる」**
NotionやWorkflowyなどの既存ツールを「重い」「遅い」と感じるパワーユーザーに向けた、キーボード操作特化型のローカルファースト・メモアプリ。TweetDeckのようなカラム型UIを採用し、断片的なアイデア（ドラフト）を高速に入力・結合・整理する。

### 1.2 コアバリュー (USP)
* **圧倒的な速度:** 起動0.5秒、入力遅延ゼロ。数万件のカードがあってもカクつかない。
* **思考の断片化:** 長文を書かせず、140字程度の「カード」を積み重ねる体験。
* **キーボード完結:** マウスに手を伸ばす時間を排除。
* **AIによる収束:** 散らばった断片をAIが文脈を理解して統合・清書する（マネタイズポイント）。

---

## 2. 技術スタック選定

「パフォーマンス」と「クロスプラットフォーム開発効率」を最優先する。

| レイヤー | 採用技術 | 選定理由 |
| :--- | :--- | :--- |
| **App Shell** | **Tauri v2** | 軽量(数MB)、爆速起動、OSネイティブWebview利用。 |
| **Backend** | **Rust** | メモリ安全性、高速処理、AI/DB制御の堅牢性。 |
| **Frontend** | **Svelte + TypeScript** | 仮想DOMを持たないため、大量のDOM描画でも高速。 |
| **Database** | **SQLite** | ローカル単一ファイル、FTS5(全文検索)、将来的なベクトル検索対応。 |
| **Editor** | **CodeMirror 6** | 軽量かつ高機能。Vimモード対応が容易。 |
| **Virtualization** | **TanStack Virtual** | 画面外の要素を描画しない仮想スクロール（必須要件）。 |

---

## 3. UI/UX デザイン

### 3.1 画面レイアウト (The Deck)
* **マルチカラム構成:** 画面を縦に分割したカラムが横に並ぶ（TweetDeck/Trelloライク）。
* **カード:** 各カラム内にテキスト入力エリア（カード）が時系列または優先度順にスタックされる。

### 3.2 入力体験の最適化
* **View / Edit モードの分離:**
    * 通常時: 軽量な `div` または Markdownレンダラー（描画コスト低）。
    * フォーカス時: `CodeMirror` インスタンスに切り替え（編集機能有効化）。
* **メンション機能:**
    * `@` 入力でRust側のFTS5検索が走り、過去のカードを高速補完。カード間のリンクを作成。

### 3.3 キーボードショートカット（マウスレス操作）

| 操作カテゴリ | キーバインディング (案) | 動作 |
| :--- | :--- | :--- |
| **ナビゲーション** | `Tab` / `Shift+Tab` | カラム間のフォーカス移動（左右） |
| | `j` / `k` (or `↑`/`↓`) | カラム内のカード移動（上下） |
| **編集アクション** | `Enter` | 選択中のカードを編集モードへ |
| | `Ctrl + Enter` | 保存して直下に新規カード作成（連続投稿） |
| | `Esc` | 編集モード終了 / 選択解除 |
| **整理・操作** | `Ctrl + ↑`/`↓` | カードの順序入れ替え |
| | `l` (like) | カードの重要度UP（スコア加算） |
| | `d` (delete) | カードの論理削除 |
| **特殊** | `Ctrl + Space` | コマンドパレット呼び出し |

---

## 4. データアーキテクチャ

将来的なクラウド同期（有料機能）を見据え、競合が発生しないスキーマ設計を行う。

### 4.1 データベース技術
* **Engine:** SQLite
* **ORM:** 生SQL または `sqlx` / `rusqlite`（パフォーマンス優先のため、重厚なORMは避ける）。

### 4.2 スキーマ定義 (Draft)

**Thoughts テーブル (メインデータ)**
```sql
CREATE TABLE thoughts (
    id TEXT PRIMARY KEY,          -- UUID v7 (時間順ソート可能・衝突回避)
    content TEXT NOT NULL,        -- メモ内容
    column_id TEXT NOT NULL,      -- 所属カラムID
    score INTEGER DEFAULT 0,      -- Like数 (重要度)
    
    -- 同期・管理用メタデータ
    created_at INTEGER NOT NULL,  -- 作成日時 (Unix Milliseconds)
    updated_at INTEGER NOT NULL,  -- 最終更新日時 (同期判定用)
    is_deleted INTEGER DEFAULT 0  -- 論理削除フラグ (0:Active, 1:Deleted)
);

-- 全文検索用インデックス (FTS5)
CREATE VIRTUAL TABLE thoughts_fts USING fts5(content, content='thoughts');
